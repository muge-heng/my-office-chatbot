{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/webpack/bootstrap","webpack://office-addin-taskpane-js/webpack/runtime/global","webpack://office-addin-taskpane-js/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane-js/webpack/runtime/publicPath","webpack://office-addin-taskpane-js/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.html"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n// --- Office Add-in Initialization ---\nOffice.onReady((info) => {\n  if (info.host === Office.HostType.Word || info.host === Office.HostType.Excel || info.host === Office.HostType.PowerPoint) {\n    initializeApp();\n  }\n});\n\n\n// --- Constants & Configuration ---\nconst AI_ASSISTANT_NAME = '星尘AI';\nconst AI_AVATAR_CHAR = '✨';\nconst EMOJIS = ['😀', '😂', '😊', '😍', '🤔', '👍', '🎉', '❤️', '🚀', '💡', '💯', '🙏', '👋', '🔥', '👀', '🌟', '💻', '🤖', '✨', '🥳', '🤯', '🙌', '🤞', '🧠', '🧑‍💻', '🌌', '🌠', '🛰️', '👽'];\nconst MAX_MESSAGES_DISPLAY = 60;\nconst MAX_HISTORY_SENT_TO_API = 12;\nconst STORAGE_KEY_MESSAGES = 'aiStardustChatMessages_v4_1_office';\nconst STORAGE_KEY_CONFIG = 'aiStardustChatApiConfig_v4_1_office';\nconst STORAGE_KEY_THEME = 'aiStardustChatTheme_v4_1_office';\n\n// --- DOM Element References ---\nconst appContainer = document.getElementById('appContainer');\nconst chatPage = document.getElementById('chatPage');\nconst settingsPage = document.getElementById('settingsPage');\nconst messageArea = document.getElementById('messageArea');\nconst messageInput = document.getElementById('messageInput');\nconst sendButton = document.getElementById('sendButton');\nconst userList = document.getElementById('userList');\nconst usernameHeader = document.getElementById('usernameHeader');\nconst userAvatarHeader = document.getElementById('userAvatarHeader');\nconst themeToggleButton = document.getElementById('themeToggleButton');\nconst themeToggleIcon = themeToggleButton.querySelector('i');\nconst settingsButton = document.getElementById('settingsButton');\nconst profileButton = document.getElementById('profileButton');\nconst emojiButton = document.getElementById('emojiButton');\nconst emojiPicker = document.getElementById('emojiPicker');\nconst typingIndicator = document.getElementById('typingIndicator');\nconst stopGeneratingButton = document.getElementById('stopGeneratingButton');\nconst closeSettingsButton = document.getElementById('closeSettingsButton');\nconst settingsUsernameInput = document.getElementById('settingsUsernameInput');\nconst darkModeToggle = document.getElementById('darkModeToggle');\nconst clearChatButton = document.getElementById('clearChatButton');\nconst clearContextButton = document.getElementById('clearContextButton');\nconst apiSettingsForm = document.getElementById('apiSettingsForm');\nconst settingsStatusIndicator = document.getElementById('settingsStatusIndicator');\nconst apiProviderRadios = document.querySelectorAll('input[name=\"apiProvider\"]');\nconst settingsApiKeyInput = document.getElementById('settingsApiKey');\nconst settingsApiUrlGroup = document.getElementById('settingsApiUrlGroup');\nconst settingsApiUrlInput = document.getElementById('settingsApiUrl');\nconst settingsDefaultApiUrls = document.getElementById('settingsDefaultApiUrls');\nconst settingsDeepseekUrl = document.getElementById('settingsDeepseekUrl');\nconst settingsOpenaiUrl = document.getElementById('settingsOpenaiUrl');\nconst settingsGeminiUrl = document.getElementById('settingsGeminiUrl');\nconst settingsModelListInput = document.getElementById('settingsModelList');\nconst settingsModelSelect = document.getElementById('settingsModelSelect');\nconst fetchModelsButton = document.getElementById('fetchModelsButton');\nconst settingsStreamingEnabled = document.getElementById('settingsStreamingEnabled');\nconst settingsReasoningEnabled = document.getElementById('settingsReasoningEnabled');\nconst reasoningOptionContainer = document.getElementById('reasoningOptionContainer');\nconst aiStyleSelect = document.getElementById('aiStyleSelect');\nconst aiStyleStrength = document.getElementById('aiStyleStrength');\nconst saveSettingsButton = document.getElementById('saveSettingsButton');\nconst customApiSettingsSection = document.getElementById('customApiSettingsSection');\nconst customBodyKeyInput = document.getElementById('customBodyKey');\nconst customBodyValueInput = document.getElementById('customBodyValue');\nconst addCustomBodyParamButton = document.getElementById('addCustomBodyParamButton');\nconst customBodyParamsList = document.getElementById('customBodyParamsList');\nconst toastNotification = document.getElementById('toastNotification');\nconst getSelectionButton = document.getElementById('getSelectionButton');\n\n// --- State Variables ---\nlet currentUsername = 'Office User';\nlet currentUserAvatarChar = 'O';\nlet currentConversationHistory = [];\nlet apiConfig = {\n    provider: 'gemini',\n    apiKey: '',\n    apiUrl: 'https://generativelanguage.googleapis.com/v1beta/models/',\n    models: [],\n    defaultModel: '',\n    streaming: true,\n    reasoning: false,\n    aiStyle: 'default',\n    aiStyleStrength: 1,\n    customBodyParams: []\n};\nlet abortController = null;\nlet isEmojiPickerOpen = false;\nlet toastTimeout;\nlet lastMessageElement = null;\nlet conversationContextId = Date.now().toString();\n\n// --- Utility Functions ---\nfunction getAvatarUrl(char, size = \"36x36\", bgColor = \"82a9ff\", textColor = \"0d0f1a\", font = \"orbitron\") {\n    const isEmoji = /\\p{Emoji}/u.test(char);\n    if (isEmoji) {\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        const dpr = window.devicePixelRatio || 1;\n        const sizePx = parseInt(size.split('x')[0]) * dpr;\n        canvas.width = sizePx;\n        canvas.height = sizePx;\n        ctx.fillStyle = `#${bgColor}`;\n        ctx.fillRect(0, 0, sizePx, sizePx);\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.font = `${sizePx * 0.65}px sans-serif`;\n        ctx.fillText(char, sizePx / 2, sizePx / 2 + sizePx * 0.08);\n        return canvas.toDataURL();\n    } else {\n        return `https://placehold.co/${size}/${bgColor}/${textColor}?text=${encodeURIComponent(char.toUpperCase())}&font=${font}`;\n    }\n}\n\nfunction getCurrentTime() {\n    return new Date().toLocaleTimeString('zh-CN', {\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: false\n    });\n}\n\nfunction scrollToBottom() {\n    setTimeout(() => {\n        messageArea.scrollTo({\n            top: messageArea.scrollHeight,\n            behavior: 'smooth'\n        });\n    }, 50);\n}\n\nfunction showToast(message, type = 'info', duration = 3500) {\n    if (toastTimeout) clearTimeout(toastTimeout);\n    let iconClass = 'fa-info-circle';\n    if (type === 'success') iconClass = 'fa-check-circle';\n    else if (type === 'error') iconClass = 'fa-times-circle';\n    else if (type === 'warning') iconClass = 'fa-exclamation-triangle';\n\n    toastNotification.innerHTML = `<i class=\"fas ${iconClass} mr-3 text-xl\"></i> <div class=\"flex-1\">${message}</div>`;\n    toastNotification.className = 'fixed bottom-6 right-6 z-[200] transition-all duration-300 px-5 py-4 rounded-xl shadow-xl text-sm font-medium flex items-start min-w-[300px] max-w-md';\n\n    toastNotification.classList.remove('opacity-0', 'translate-y-5', 'scale-95', 'success', 'error', 'warning', 'info');\n\n    if (type === 'success') {\n        toastNotification.style.backgroundColor = 'var(--success-color)';\n        toastNotification.style.color = 'white';\n    } else if (type === 'error') {\n        toastNotification.style.backgroundColor = 'var(--error-color)';\n        toastNotification.style.color = 'white';\n    } else if (type === 'warning') {\n        toastNotification.style.backgroundColor = 'var(--warning-color)';\n        toastNotification.style.color = document.documentElement.classList.contains('light') ? '#573a00' : '#fef3c7';\n    } else {\n        toastNotification.style.backgroundColor = 'var(--text-accent)';\n        toastNotification.style.color = 'white';\n    }\n\n    requestAnimationFrame(() => {\n        toastNotification.style.opacity = '1';\n        toastNotification.style.transform = 'translateY(0) scale(1)';\n    });\n    toastTimeout = setTimeout(() => {\n        toastNotification.style.opacity = '0';\n        toastNotification.style.transform = 'translateY(5px) scale(0.95)';\n    }, duration);\n}\n\nfunction navigateTo(targetPageId) {\n    document.querySelectorAll('.page').forEach(page => {\n        if (page.id === targetPageId) {\n            if (page.classList.contains('hidden')) {\n                page.classList.remove('hidden');\n                page.classList.add('entering');\n                requestAnimationFrame(() => requestAnimationFrame(() => page.classList.remove('entering')));\n            }\n        } else if (!page.classList.contains('hidden')) page.classList.add('hidden');\n    });\n    if (targetPageId !== 'chatPage' && isEmojiPickerOpen) toggleEmojiPicker(false);\n    if (targetPageId === 'settingsPage') loadSettingsToUI();\n}\n\nfunction applyTheme(isLight) {\n    const htmlEl = document.documentElement;\n    if (isLight) {\n        htmlEl.classList.add('light');\n        themeToggleIcon.classList.remove('fa-moon');\n        themeToggleIcon.classList.add('fa-sun');\n        if (darkModeToggle) darkModeToggle.checked = true;\n    } else {\n        htmlEl.classList.remove('light');\n        themeToggleIcon.classList.remove('fa-sun');\n        themeToggleIcon.classList.add('fa-moon');\n        if (darkModeToggle) darkModeToggle.checked = false;\n    }\n    userAvatarHeader.src = getAvatarUrl(currentUserAvatarChar, \"36x36\", isLight ? \"3b82f6\" : \"82a9ff\", isLight ? \"ffffff\" : \"0d0f1a\");\n    renderUserList();\n    setTimeout(() => Prism.highlightAll(), 50);\n}\n\nfunction toggleTheme() {\n    const isLight = document.documentElement.classList.toggle('light');\n    applyTheme(isLight);\n    localStorage.setItem(STORAGE_KEY_THEME, isLight ? 'light' : 'dark');\n}\n\nfunction loadConfig() {\n    const savedConfig = localStorage.getItem(STORAGE_KEY_CONFIG);\n    if (savedConfig) {\n        try {\n            const parsedConfig = JSON.parse(savedConfig);\n            apiConfig = { ...apiConfig,\n                ...parsedConfig\n            };\n            if (!Array.isArray(apiConfig.models)) apiConfig.models = [];\n            if (!Array.isArray(apiConfig.customBodyParams)) apiConfig.customBodyParams = [];\n        } catch (e) {\n            console.error('Failed to parse saved API config:', e);\n            showToast('无法加载API配置，使用默认设置。', 'error');\n            localStorage.removeItem(STORAGE_KEY_CONFIG);\n        }\n    }\n\n    if (apiConfig.provider !== 'custom') {\n        updateApiUrlForProvider(apiConfig.provider, false);\n    } else if (apiConfig.provider === 'custom' && !apiConfig.apiUrl) {\n        apiConfig.apiUrl = '';\n    }\n\n    const savedUsername = settingsUsernameInput.value.trim();\n    if (savedUsername) {\n        currentUsername = savedUsername;\n        currentUserAvatarChar = currentUsername.charAt(0)?.toUpperCase() || 'O';\n        usernameHeader.textContent = currentUsername;\n    }\n\n    updateModelSelectDropdown();\n    renderCustomBodyParamsList();\n}\n\nfunction updateApiUrlForProvider(provider, shouldSaveConfig = true) {\n    switch (provider) {\n        case 'deepseek':\n            apiConfig.apiUrl = 'https://api.deepseek.com/v1';\n            break;\n        case 'openai':\n            apiConfig.apiUrl = 'https://api.openai.com/v1';\n            break;\n        case 'gemini':\n            apiConfig.apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/';\n            break;\n        case 'custom':\n            break;\n        default:\n            apiConfig.apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/';\n    }\n    if (settingsApiUrlInput && provider !== 'custom') {\n        settingsApiUrlInput.value = apiConfig.apiUrl;\n    }\n    if (shouldSaveConfig) saveConfig();\n}\n\nfunction saveConfig() {\n    try {\n        localStorage.setItem(STORAGE_KEY_CONFIG, JSON.stringify(apiConfig));\n        return true;\n    } catch (e) {\n        console.error('Failed to save API config:', e);\n        showToast('保存API配置失败！', 'error');\n        return false;\n    }\n}\n\nfunction loadSettingsToUI() {\n    settingsUsernameInput.value = currentUsername;\n\n    const providerRadio = document.querySelector(`input[name=\"apiProvider\"][value=\"${apiConfig.provider}\"]`);\n    if (providerRadio) providerRadio.checked = true;\n\n    settingsApiKeyInput.value = apiConfig.apiKey;\n    settingsApiUrlInput.value = apiConfig.apiUrl;\n\n    settingsModelListInput.value = apiConfig.models.join(',');\n    settingsStreamingEnabled.checked = apiConfig.streaming;\n    settingsReasoningEnabled.checked = apiConfig.reasoning;\n    aiStyleSelect.value = apiConfig.aiStyle;\n    aiStyleStrength.value = apiConfig.aiStyleStrength;\n\n    updateApiUrlVisibility();\n    updateModelSelectDropdown();\n    renderCustomBodyParamsList();\n}\n\nfunction updateApiUrlVisibility() {\n    const selectedProvider = document.querySelector('input[name=\"apiProvider\"]:checked')?.value || apiConfig.provider;\n\n    settingsApiUrlGroup.style.display = selectedProvider === 'custom' ? 'block' : 'none';\n    customApiSettingsSection.style.display = selectedProvider === 'custom' ? 'block' : 'none';\n    settingsDefaultApiUrls.style.display = selectedProvider !== 'custom' ? 'block' : 'none';\n\n    if (selectedProvider !== 'custom') {\n        settingsDeepseekUrl.style.display = selectedProvider === 'deepseek' ? 'block' : 'none';\n        settingsOpenaiUrl.style.display = selectedProvider === 'openai' ? 'block' : 'none';\n        settingsGeminiUrl.style.display = selectedProvider === 'gemini' ? 'block' : 'none';\n    }\n    reasoningOptionContainer.style.display = selectedProvider === 'deepseek' ? 'block' : 'none';\n    if (selectedProvider !== 'deepseek') settingsReasoningEnabled.checked = false;\n}\n\nfunction updateModelSelectDropdown() {\n    settingsModelSelect.innerHTML = '';\n    if (apiConfig.models && apiConfig.models.length > 0) {\n        apiConfig.models.forEach(model => {\n            const option = document.createElement('option');\n            option.value = model;\n            option.textContent = model;\n            settingsModelSelect.appendChild(option);\n        });\n        settingsModelSelect.value = apiConfig.defaultModel || apiConfig.models[0];\n    } else {\n        const defaultOption = document.createElement('option');\n        defaultOption.value = '';\n        defaultOption.textContent = '-- 无可用模型 --';\n        settingsModelSelect.appendChild(defaultOption);\n    }\n}\n\nfunction showSettingsStatus(message, type = 'success') {\n    let iconClass = 'fa-info-circle';\n    if (type === 'success') iconClass = 'fa-check-circle';\n    else if (type === 'error') iconClass = 'fa-times-circle';\n    else if (type === 'warning') iconClass = 'fa-exclamation-triangle';\n\n    settingsStatusIndicator.innerHTML = `<i class=\"fas ${iconClass} mr-2.5 text-lg\"></i> ${message}`;\n    settingsStatusIndicator.className = `status-indicator fixed top-5 right-5 z-[100] glassmorphism !p-3 !rounded-xl flex items-center`;\n\n    if (type === 'success') settingsStatusIndicator.style.color = 'var(--success-color)';\n    else if (type === 'error') settingsStatusIndicator.style.color = 'var(--error-color)';\n    else if (type === 'warning') settingsStatusIndicator.style.color = 'var(--warning-color)';\n    else settingsStatusIndicator.style.color = 'var(--text-accent)';\n\n    settingsStatusIndicator.style.display = 'flex';\n    setTimeout(() => {\n        settingsStatusIndicator.style.display = 'none';\n    }, 4000);\n}\n\nfunction configureMarkdown() {\n    marked.setOptions({\n        breaks: false,\n        gfm: true,\n        highlight: (code, lang) => {\n            const language = lang || 'plaintext';\n            if (Prism.languages[language]) {\n                return Prism.highlight(code, Prism.languages[language], language);\n            }\n            return code;\n        }\n    });\n    const renderer = new marked.Renderer();\n    renderer.code = function(code, infostring, escaped) {\n        const lang = (infostring || '').match(/\\S*/)[0];\n        const highlightedCode = this.options.highlight(code, lang);\n        \n        let langClass = lang ? `${this.options.langPrefix}${lang}` : `${this.options.langPrefix}plaintext`;\n        \n        return `<pre class=\"${langClass}\" data-lang=\"${lang || 'plaintext'}\"><code class=\"${langClass}\">${highlightedCode}\\n</code></pre>\\n`;\n    };\n\n    const originalParagraph = renderer.paragraph.bind(renderer);\n    renderer.paragraph = (text) => {\n        text = text.replace(/\\$(.+?)\\$/g, (match, formula) => {\n            try {\n                return katex.renderToString(formula, { throwOnError: false, displayMode: false });\n            } catch (e) {\n                return `<span class=\"katex-error\" title=\"${e.message}\">${match}</span>`;\n            }\n        });\n        text = text.replace(/\\$\\$([\\s\\S]+?)\\$\\$/g, (match, formula) => {\n            try {\n                return katex.renderToString(formula.trim(), { throwOnError: false, displayMode: true });\n            } catch (e) {\n                return `<div class=\"katex-error\" title=\"${e.message}\"><pre>${formula.trim()}</pre></div>`;\n            }\n        });\n        return originalParagraph(text);\n    };\n    marked.use({\n        renderer\n    });\n}\n\n\nfunction highlightCodeInElement(element) {\n    if (typeof Prism !== 'undefined') {\n        Prism.highlightAllUnder(element || document.body);\n        addOfficeActionButtons(element || document.body);\n    }\n}\n\nfunction renderMessageContent(rawContent) {\n    let htmlContent = marked.parse(rawContent);\n    // For a private tool, we can trust the content from the API.\n    // However, it's still good practice to sanitize, especially if user-quoted content is involved.\n    // We'll keep DOMPurify for this reason.\n    return DOMPurify.sanitize(htmlContent, {\n        USE_PROFILES: {\n            html: true\n        },\n        ADD_TAGS: ['math', 'annotation', 'semantics', 'mtext', 'mn', 'mo', 'mi', 'mspace', 'mover', 'munder', 'munderover', 'mstyle', 'mfrac', 'msqrt', 'mroot', 'mtable', 'mtr', 'mtd', 'mlabeledtr'],\n        ADD_ATTR: ['encoding', 'xmlns', 'class', 'style', 'aria-hidden', 'title', 'start', 'data-lang']\n    });\n}\n\nfunction displayMessage(sender, text, isOwnMessage, avatarChar = '?', timestamp = null, messageId = null, reasoningContent = null) {\n    if (!text && !isOwnMessage && !reasoningContent && !messageId) return;\n    const msgId = messageId || `msg-${Date.now()}-${Math.random().toString(16).slice(2)}`;\n    let existingMessageElement = document.getElementById(msgId);\n\n    if (existingMessageElement && !isOwnMessage) {\n        const bubble = existingMessageElement.querySelector('.message-bubble');\n        const textElement = bubble.querySelector('.message-text');\n        if (textElement) {\n            textElement.innerHTML = renderMessageContent(text || '');\n            highlightCodeInElement(textElement);\n        }\n        if (apiConfig.provider === 'deepseek' && apiConfig.reasoning && reasoningContent !== null) {\n            let reasoningElement = bubble.querySelector('.reasoning-content');\n            if (!reasoningElement && reasoningContent) {\n                reasoningElement = document.createElement('div');\n                reasoningElement.className = 'reasoning-content';\n                bubble.insertBefore(reasoningElement, textElement);\n            }\n            if (reasoningElement) reasoningElement.textContent = reasoningContent;\n        }\n        lastMessageElement = existingMessageElement;\n        scrollToBottom();\n        return existingMessageElement;\n    }\n\n    const messageElement = document.createElement('div');\n    messageElement.id = msgId;\n    messageElement.classList.add('flex', 'items-start', 'max-w-full', 'group', 'mb-1.5', 'py-2');\n\n    const avatarColorIsLight = document.documentElement.classList.contains('light');\n    const avatarBg = isOwnMessage ? (avatarColorIsLight ? \"3b82f6\" : \"6a82fb\") : (sender === AI_ASSISTANT_NAME ? (avatarColorIsLight ? \"10b981\" : \"2dd4bf\") : \"a0a8c0\");\n    const avatarText = isOwnMessage ? (avatarColorIsLight ? \"ffffff\" : \"e0e7ff\") : (sender === AI_ASSISTANT_NAME ? (avatarColorIsLight ? \"ffffff\" : \"0d0f1a\") : \"1a1c2d\");\n\n    const avatarElement = document.createElement('img');\n    avatarElement.src = getAvatarUrl(avatarChar, \"36x36\", avatarBg, avatarText);\n    avatarElement.alt = `${sender} avatar`;\n    avatarElement.classList.add('w-9', 'h-9', 'rounded-full', 'flex-shrink-0', 'shadow-md', 'border-2', 'border-[var(--bg-secondary)]');\n\n    const messageContentWrapper = document.createElement('div');\n    messageContentWrapper.className = 'flex flex-col mx-2.5 flex-grow min-w-0';\n\n    const bubble = document.createElement('div');\n    bubble.classList.add('message-bubble', 'relative');\n    bubble.classList.add(isOwnMessage ? 'my-message' : 'other-message');\n\n    const textElement = document.createElement('div');\n    textElement.classList.add('message-text', 'break-words');\n    textElement.innerHTML = (sender === AI_ASSISTANT_NAME && !text) ? '' : renderMessageContent(text || '');\n\n    bubble.appendChild(textElement);\n\n    if (apiConfig.provider === 'deepseek' && apiConfig.reasoning && reasoningContent && !isOwnMessage) {\n        const reasoningElement = document.createElement('div');\n        reasoningElement.className = 'reasoning-content';\n        reasoningElement.textContent = reasoningContent;\n        bubble.appendChild(reasoningElement);\n    }\n    \n    messageContentWrapper.appendChild(bubble);\n\n    if (!isOwnMessage && text) {\n        const actionsContainer = document.createElement('div');\n        actionsContainer.className = 'message-actions mt-1.5';\n        \n        const insertBtn = document.createElement('button');\n        insertBtn.className = 'message-action-btn';\n        insertBtn.innerHTML = '<i class=\"fas fa-file-download mr-1\"></i> 插入全文';\n        insertBtn.onclick = () => insertContent(textElement.innerText);\n        actionsContainer.appendChild(insertBtn);\n        \n        messageContentWrapper.appendChild(actionsContainer);\n    }\n\n    if (isOwnMessage) {\n        messageElement.classList.add('justify-end');\n        messageContentWrapper.classList.add('items-end');\n        messageElement.appendChild(messageContentWrapper);\n        messageElement.appendChild(avatarElement);\n    } else {\n        messageElement.classList.add('justify-start');\n        messageContentWrapper.classList.add('items-start');\n        messageElement.appendChild(avatarElement);\n        messageElement.appendChild(messageContentWrapper);\n    }\n\n    messageArea.appendChild(messageElement);\n    while (messageArea.children.length > MAX_MESSAGES_DISPLAY + 1) {\n        if (messageArea.firstElementChild?.querySelector('.text-xs.px-2')) {\n            if (messageArea.children.length > 2) messageArea.removeChild(messageArea.children[1]);\n            else break;\n        } else {\n            messageArea.removeChild(messageArea.firstElementChild);\n        }\n    }\n    if (text) highlightCodeInElement(bubble);\n\n    if (text || isOwnMessage) scrollToBottom();\n    if (!isOwnMessage) lastMessageElement = messageElement;\n    return messageElement;\n}\n\n\nfunction sendMessage() {\n    const messageText = messageInput.value.trim();\n    if (!messageText) return;\n    if (abortController) {\n        showToast('AI 正在回复，请稍候...', 'warning');\n        return;\n    }\n\n    let systemPrompt = \"请在回复时遵循以下规则：如果你需要提供Excel公式，必须使用Markdown的代码框格式，并标记语言为 `formula`，例如：```formula\\n=SUM(A1:A10)\\n```。对于其他代码，也请使用对应的语言标记。\";\n    if (apiConfig.aiStyle !== 'default') {\n        switch (apiConfig.aiStyle) {\n            case 'professional': systemPrompt += ' 请用专业、严谨的语气回答。'; break;\n            case 'friendly': systemPrompt += ' 请用友好、亲切的语气回答。'; break;\n            case 'humorous': systemPrompt += ' 请用幽默、风趣的语气回答。'; break;\n            case 'concise': systemPrompt += ' 请用简洁、直接的方式回答。'; break;\n            case 'detailed': systemPrompt += ' 请提供详细、全面的回答。'; break;\n        }\n        if (apiConfig.aiStyleStrength > 1.1) systemPrompt += ` (风格强度: ${apiConfig.aiStyleStrength}, 请更强调此风格)`;\n        else if (apiConfig.aiStyleStrength < 0.9) systemPrompt += ` (风格强度: ${apiConfig.aiStyleStrength}, 请柔和表达此风格)`;\n    }\n\n    let messagesToSend = [];\n    if (apiConfig.provider === 'openai' || apiConfig.provider === 'deepseek' || apiConfig.provider === 'custom') {\n        if (systemPrompt) messagesToSend.push({ role: 'system', content: systemPrompt });\n        messagesToSend = [...messagesToSend, ...currentConversationHistory.slice(-MAX_HISTORY_SENT_TO_API).map(m => ({ role: m.role, content: m.content }))];\n        messagesToSend.push({ role: 'user', content: messageText });\n    } else if (apiConfig.provider === 'gemini') {\n        let currentTurnContent = messageText;\n        currentConversationHistory.slice(-MAX_HISTORY_SENT_TO_API).forEach(msg => {\n            messagesToSend.push({ role: msg.role === 'assistant' ? 'model' : 'user', parts: [{ text: msg.content }] });\n        });\n        if (systemPrompt && messagesToSend.length === 0) {\n            currentTurnContent = systemPrompt + \"\\n\\n\" + messageText;\n        }\n        messagesToSend.push({ role: 'user', parts: [{ text: currentTurnContent }] });\n    }\n\n    displayMessage(currentUsername, messageText, true, currentUserAvatarChar);\n    currentConversationHistory.push({ role: 'user', content: messageText, contextId: conversationContextId });\n    saveConversationToStorage();\n\n    messageInput.value = '';\n    messageInput.style.height = 'auto';\n    messageInput.focus();\n    sendButton.disabled = true;\n    if (isEmojiPickerOpen) toggleEmojiPicker(false);\n\n    if (!apiConfig.apiKey || !apiConfig.apiUrl) {\n        displayMessage(AI_ASSISTANT_NAME, '错误：API 密钥或地址未配置。请在设置中配置。', false, AI_AVATAR_CHAR);\n        return;\n    }\n    if (!apiConfig.defaultModel) {\n        displayMessage(AI_ASSISTANT_NAME, '错误：未选择默认模型。请在设置中选择。', false, AI_AVATAR_CHAR);\n        return;\n    }\n\n    const aiMessageId = `msg-ai-${Date.now()}`;\n    displayMessage(AI_ASSISTANT_NAME, '', false, AI_AVATAR_CHAR, null, aiMessageId);\n    showTypingIndicator();\n    stopGeneratingButton.style.display = 'inline-flex';\n    abortController = new AbortController();\n\n    callChatAPI(apiConfig.defaultModel, messagesToSend, apiConfig.streaming, aiMessageId, (chunk, done, reasoningChunk) => {\n        if (done) {\n            hideTypingIndicator();\n            stopGeneratingButton.style.display = 'none';\n            abortController = null;\n            const finalElement = document.getElementById(aiMessageId);\n            if (finalElement) {\n                const finalContent = finalElement.querySelector('.message-text')?.innerText || '[空响应]';\n                const lastAiMsg = currentConversationHistory.filter(m => m.role === 'assistant').pop();\n                if (!lastAiMsg || lastAiMsg.content !== finalContent) {\n                    currentConversationHistory.push({ role: 'assistant', content: finalContent, contextId: conversationContextId });\n                    saveConversationToStorage();\n                }\n                while (currentConversationHistory.length > MAX_MESSAGES_DISPLAY * 2) currentConversationHistory.shift();\n            }\n        }\n    });\n}\n\nasync function callChatAPI(model, messages, streaming, messageId, callback) {\n    let url = apiConfig.apiUrl.replace(/\\/$/, '');\n    const headers = { 'Content-Type': 'application/json' };\n    \n    // ==========================================================\n    // THIS IS THE FIX. Add the Authorization header for non-Gemini providers.\n    // ==========================================================\n    if (apiConfig.provider !== 'gemini') {\n        headers['Authorization'] = `Bearer ${apiConfig.apiKey}`;\n    }\n\n    let requestBodyPayload = {};\n    let effectiveModelName = model;\n\n    if (apiConfig.provider === 'gemini') {\n        // Gemini uses the API key in the URL parameter.\n        url += `/${effectiveModelName}:streamGenerateContent?key=${apiConfig.apiKey}&alt=sse`;\n        requestBodyPayload = { contents: messages };\n    } else {\n        // Other providers use the Authorization header.\n        url += '/chat/completions';\n        effectiveModelName = (apiConfig.provider === 'deepseek' && apiConfig.reasoning) ? 'deepseek-reasoner' : model;\n        requestBodyPayload = {\n            model: effectiveModelName,\n            messages: messages,\n            stream: streaming\n        };\n    }\n\n    if (apiConfig.provider === 'custom' && Array.isArray(apiConfig.customBodyParams)) {\n        apiConfig.customBodyParams.forEach(param => {\n            try { requestBodyPayload[param.key] = JSON.parse(param.value); }\n            catch (e) { requestBodyPayload[param.key] = param.value; }\n        });\n    }\n    const body = JSON.stringify(requestBodyPayload);\n\n    try {\n        const response = await fetch(url, { method: 'POST', headers, body, signal: abortController?.signal });\n        if (!response.ok) {\n            let errorData;\n            try { errorData = await response.json(); } catch (e) { errorData = { error: { message: response.statusText } }; }\n            // Use the JSON message if available, otherwise fall back to status text.\n            const errorDetail = errorData.error?.message || errorData.message || response.statusText;\n            const errorMessage = `API Error (${response.status}): ${errorDetail}`;\n            console.error(errorMessage, errorData);\n            displayMessage(AI_ASSISTANT_NAME, `抱歉，请求出错：${errorMessage}`, false, AI_AVATAR_CHAR, null, messageId);\n            callback(null, true, null);\n            return;\n        }\n\n        if ((streaming || apiConfig.provider === 'gemini') && response.body) {\n            const reader = response.body.getReader();\n            const decoder = new TextDecoder();\n            let buffer = '';\n            let fullResponseContent = '';\n            let fullReasoningContent = '';\n\n            while (true) {\n                const { done, value } = await reader.read();\n                if (done) break;\n                buffer += decoder.decode(value, { stream: true });\n\n                let endOfLineIndex;\n                while ((endOfLineIndex = buffer.indexOf('\\n')) >= 0) {\n                    const line = buffer.substring(0, endOfLineIndex).trim();\n                    buffer = buffer.substring(endOfLineIndex + 1);\n\n                    if (line.startsWith('data:')) {\n                        const dataString = line.substring(5).trim();\n                        if (dataString === '[DONE]' && apiConfig.provider !== 'gemini') {\n                            reader.cancel();\n                            callback(fullResponseContent, true, fullReasoningContent);\n                            return;\n                        }\n                        try {\n                            const data = JSON.parse(dataString);\n                            let chunkContent = '';\n                            let currentReasoningChunk = null;\n\n                            if (apiConfig.provider === 'gemini') {\n                                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {\n                                    chunkContent = data.candidates[0].content.parts[0].text;\n                                }\n                            } else {\n                                if (data.choices && data.choices[0].delta) {\n                                    if (data.choices[0].delta.content) chunkContent = data.choices[0].delta.content;\n                                    if (apiConfig.provider === 'deepseek' && apiConfig.reasoning && data.choices[0].delta.reasoning_content) {\n                                        currentReasoningChunk = data.choices[0].delta.reasoning_content;\n                                    }\n                                }\n                            }\n\n                            if (chunkContent) fullResponseContent += chunkContent;\n                            if (currentReasoningChunk) fullReasoningContent += currentReasoningChunk;\n\n                            displayMessage(AI_ASSISTANT_NAME, fullResponseContent, false, AI_AVATAR_CHAR, null, messageId, apiConfig.provider === 'deepseek' ? fullReasoningContent : null);\n                        } catch (e) {\n                            console.warn('Failed to parse stream data line:', dataString, e);\n                        }\n                    }\n                }\n            }\n            callback(fullResponseContent, true, apiConfig.provider === 'deepseek' ? fullReasoningContent : null);\n        } else {\n            const data = await response.json();\n            let responseContent = '';\n            let reasoningData = null;\n            if (apiConfig.provider === 'gemini') {\n                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {\n                    responseContent = data.candidates[0].content.parts[0].text;\n                } else if (data.promptFeedback && data.promptFeedback.blockReason){\n                    responseContent = `请求被阻止: ${data.promptFeedback.blockReason}`;\n                    if(data.promptFeedback.blockReasonMessage) responseContent += ` - ${data.promptFeedback.blockReasonMessage}`;\n                }\n            } else {\n                if (data.choices && data.choices[0].message && data.choices[0].message.content) {\n                    responseContent = data.choices[0].message.content;\n                    if (apiConfig.provider === 'deepseek' && apiConfig.reasoning && data.choices[0].message.reasoning_content) {\n                        reasoningData = data.choices[0].message.reasoning_content;\n                    }\n                }\n            }\n            if (responseContent) {\n                 displayMessage(AI_ASSISTANT_NAME, responseContent, false, AI_AVATAR_CHAR, null, messageId, reasoningData);\n                 callback(responseContent, true, reasoningData);\n             } else {\n                 displayMessage(AI_ASSISTANT_NAME, '错误：API响应无效或内容为空。', false, AI_AVATAR_CHAR, null, messageId);\n                 callback(null, true, null);\n             }\n        }\n    } catch (error) {\n        if (error.name === 'AbortError') {\n            const finalElement = document.getElementById(messageId);\n            const partialContent = finalElement?.querySelector('.message-text')?.innerText || '';\n            displayMessage(AI_ASSISTANT_NAME, partialContent + '\\n[AI 回复已手动停止]', false, AI_AVATAR_CHAR, null, messageId);\n            if (partialContent.trim()) {\n                currentConversationHistory.push({ role: 'assistant', content: partialContent + '\\n[手动停止]', contextId: conversationContextId });\n                saveConversationToStorage();\n            }\n        } else {\n            console.error('API Call Failed:', error);\n            displayMessage(AI_ASSISTANT_NAME, `连接 API 时出错：${error.message}`, false, AI_AVATAR_CHAR, null, messageId);\n        }\n        callback(null, true, null);\n    } finally {\n        if (abortController && !abortController.signal.aborted) {\n            hideTypingIndicator(); stopGeneratingButton.style.display = 'none'; abortController = null;\n        } else if (!abortController) {\n            hideTypingIndicator(); stopGeneratingButton.style.display = 'none';\n        }\n    }\n}\n\n\nasync function fetchModels() {\n    if (!apiConfig.apiKey || !apiConfig.apiUrl) {\n        showSettingsStatus('请先填写 API 密钥和地址。', 'error'); return;\n    }\n    let modelsUrl = apiConfig.apiUrl.replace(/\\/$/, '');\n    let fetchHeaders = { 'Content-Type': 'application/json' };\n\n    if (apiConfig.provider === 'gemini') {\n        modelsUrl += `?key=${apiConfig.apiKey}`;\n    } else {\n        modelsUrl += '/models';\n        fetchHeaders['Authorization'] = `Bearer ${apiConfig.apiKey}`;\n    }\n\n    fetchModelsButton.disabled = true;\n    fetchModelsButton.innerHTML = '<i class=\"fas fa-spinner fa-spin mr-1\"></i> 获取中...';\n    try {\n        const response = await fetch(modelsUrl, { method: 'GET', headers: fetchHeaders });\n        if (!response.ok) {\n            const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));\n            const errorDetail = errorData.error?.message || errorData.message || response.statusText;\n            throw new Error(`(${response.status}): ${errorDetail}`);\n        }\n        const data = await response.json();\n        let modelIds = [];\n        if (apiConfig.provider === 'gemini') {\n            if (data.models && Array.isArray(data.models)) {\n                modelIds = data.models\n                    .filter(model => model.supportedGenerationMethods?.includes(\"generateContent\") && model.name && !model.name.includes(\"embedContent\") && !model.name.includes(\"aqa\"))\n                    .map(model => model.name.startsWith(\"models/\") ? model.name.substring(7) : model.name)\n                    .sort((a,b) => {\n                        if (a.includes('flash') && !b.includes('flash')) return -1;\n                        if (!a.includes('flash') && b.includes('flash')) return 1;\n                        if (a.includes('pro') && !b.includes('pro')) return -1;\n                        if (!a.includes('pro') && b.includes('pro')) return 1;\n                        return a.localeCompare(b);\n                    });\n            }\n        } else {\n            if (data.data && Array.isArray(data.data)) modelIds = data.data.map(model => model.id).filter(Boolean).sort();\n            else if (Array.isArray(data)) modelIds = data.map(model => typeof model === 'string' ? model : model.id).filter(Boolean).sort();\n        }\n\n        if (modelIds.length > 0) {\n            apiConfig.models = modelIds; settingsModelListInput.value = modelIds.join(',');\n            updateModelSelectDropdown();\n            if (!apiConfig.defaultModel || !apiConfig.models.includes(apiConfig.defaultModel)) {\n                let preferredModel = apiConfig.models[0];\n                if (apiConfig.provider === 'gemini') {\n                    preferredModel = apiConfig.models.find(m => m.includes('flash-latest')) || apiConfig.models.find(m => m.includes('flash')) || apiConfig.models.find(m => m.includes('pro-latest')) || apiConfig.models.find(m => m.includes('pro')) || apiConfig.models[0];\n                } else if (apiConfig.provider === 'openai') {\n                    preferredModel = apiConfig.models.find(m => m.includes('gpt-3.5-turbo')) || apiConfig.models.find(m => m.includes('gpt-4')) || apiConfig.models[0];\n                } else if (apiConfig.provider === 'deepseek') {\n                    preferredModel = apiConfig.models.find(m => m.includes('deepseek-chat')) || apiConfig.models[0];\n                }\n                apiConfig.defaultModel = preferredModel;\n                settingsModelSelect.value = apiConfig.defaultModel;\n            }\n            showSettingsStatus('模型列表已成功获取！', 'success');\n        } else showSettingsStatus('未能获取到模型列表，请检查API配置或手动填写。', 'warning');\n    } catch (error) {\n        console.error('Fetch models error:', error);\n        showSettingsStatus(`获取模型列表出错: ${error.message}`, 'error');\n    } finally {\n        fetchModelsButton.disabled = false;\n        fetchModelsButton.innerHTML = '<i class=\"fas fa-cloud-download-alt\"></i> 自动获取模型';\n    }\n}\n\n// --- Office Interaction Functions ---\n\nfunction getSelectedContent() {\n  const coercionType = Office.context.host === Office.HostType.Excel ? Office.CoercionType.Table : Office.CoercionType.Text;\n  \n  Office.context.document.getSelectedDataAsync(coercionType, (asyncResult) => {\n    if (asyncResult.status === Office.AsyncResultStatus.Failed) {\n      if (Office.context.host === Office.HostType.Excel) {\n          Office.context.document.getSelectedDataAsync(Office.CoercionType.Text, (textResult) => {\n              if (textResult.status === Office.AsyncResultStatus.Succeeded) {\n                  processSelectedContent(textResult.value, false);\n              } else {\n                  showToast(`获取选中内容失败: ${textResult.error.message}`, 'error');\n              }\n          });\n      } else {\n        showToast(`获取选中内容失败: ${asyncResult.error.message}`, 'error');\n      }\n    } else {\n        const isTable = asyncResult.value.headers !== undefined;\n        processSelectedContent(asyncResult.value, isTable);\n    }\n  });\n}\n\nfunction processSelectedContent(content, isTable) {\n    let formattedContent = '';\n    if (isTable) {\n        const headers = content.headers[0];\n        const rows = content.rows;\n        const headerLine = `| ${headers.join(' | ')} |`;\n        const separatorLine = `|${headers.map(() => '---').join('|')}|`;\n        const rowLines = rows.map(row => `| ${row.join(' | ')} |`).join('\\n');\n        formattedContent = `${headerLine}\\n${separatorLine}\\n${rowLines}`;\n    } else {\n        formattedContent = String(content);\n    }\n\n    if (formattedContent.trim()) {\n        const currentInput = messageInput.value;\n        messageInput.value = currentInput ? `${currentInput}\\n\\n---\\n引用内容:\\n${formattedContent}` : formattedContent;\n        messageInput.focus();\n        adjustTextareaHeight();\n        sendButton.disabled = false;\n        showToast('已获取选中内容', 'success');\n    } else {\n        showToast('未选中任何内容或内容为空', 'warning');\n    }\n}\n\n\nfunction insertContent(text) {\n  Office.context.document.setSelectedDataAsync(text, { coercionType: Office.CoercionType.Text }, (asyncResult) => {\n    if (asyncResult.status === Office.AsyncResultStatus.Failed) {\n      showToast(`插入失败: ${asyncResult.error.message}`, 'error');\n    } else {\n      showToast('内容已插入', 'success');\n    }\n  });\n}\n\nfunction insertCodeOrFormula(codeElement) {\n    const rawCode = codeElement.innerText;\n    if (!rawCode) return;\n    insertContent(rawCode);\n}\n\nfunction addOfficeActionButtons(container) {\n    container.querySelectorAll('pre[data-lang]').forEach(pre => {\n        if (pre.querySelector('.insert-code-btn')) return;\n\n        const lang = pre.getAttribute('data-lang');\n        const codeElement = pre.querySelector('code');\n        if (!codeElement) return;\n\n        const actionButton = document.createElement('button');\n        actionButton.className = 'message-action-btn insert-code-btn';\n        actionButton.style.position = 'absolute';\n        actionButton.style.top = '8px';\n        actionButton.style.right = '8px';\n        actionButton.style.zIndex = '1';\n\n        if (lang.toLowerCase() === 'formula' && Office.context.host === Office.HostType.Excel) {\n            actionButton.innerHTML = '<i class=\"fas fa-calculator mr-1\"></i> 插入公式';\n        } else {\n            actionButton.innerHTML = '<i class=\"fas fa-code mr-1\"></i> 插入代码';\n        }\n\n        actionButton.onclick = (e) => {\n            e.stopPropagation();\n            insertCodeOrFormula(codeElement);\n        };\n        \n        pre.appendChild(actionButton);\n        const prismToolbar = pre.querySelector('.toolbar');\n        if (prismToolbar) prismToolbar.style.display = 'none';\n    });\n}\n\n\n// --- Other functions ---\nfunction stopGeneration() {\n    if (abortController) {\n        abortController.abort();\n        showToast('已停止 AI 回复', 'info');\n    }\n}\n\nfunction saveConversationToStorage() {\n    try {\n        const c = JSON.parse(localStorage.getItem(STORAGE_KEY_MESSAGES)) || {};\n        c[conversationContextId] = { u: currentUsername, aC: currentUserAvatarChar, t: Date.now(), m: currentConversationHistory };\n        localStorage.setItem(STORAGE_KEY_MESSAGES, JSON.stringify(c));\n    } catch (e) { console.error(e); }\n}\n\nfunction loadConversationFromStorage() {\n    try {\n        const c = JSON.parse(localStorage.getItem(STORAGE_KEY_MESSAGES)) || {};\n        if (c[conversationContextId]) {\n            const cv = c[conversationContextId];\n            currentConversationHistory = cv.m || [];\n            messageArea.innerHTML = '<div class=\"text-center my-3\"><span class=\"text-xs px-3 py-1.5 rounded-full bg-[var(--bg-accent)] text-[var(--text-secondary)] shadow-sm glassmorphism border-none\">加载历史对话</span></div>';\n            currentConversationHistory.forEach(m => {\n                if (m.role === 'user') displayMessage(currentUsername, m.content, true, currentUserAvatarChar);\n                else if (m.role === 'assistant') displayMessage(AI_ASSISTANT_NAME, m.content, false, AI_AVATAR_CHAR);\n            });\n            scrollToBottom();\n            return true;\n        }\n    } catch (e) { console.error(e); }\n    return false;\n}\n\nfunction clearCurrentConversation() {\n    showToast('确定要清空当前聊天记录吗？此操作无法撤销。<br><div class=\"mt-3 flex gap-2 justify-end\"><button id=\"confirmClear\" class=\"btn !bg-[var(--error-color)] !text-white !text-xs !py-1 !px-3\">确认清空</button><button id=\"cancelClear\" class=\"btn btn-secondary !text-xs !py-1 !px-3\">取消</button></div>', 'warning', 10000);\n    document.getElementById('confirmClear')?.addEventListener('click', () => {\n        currentConversationHistory = [];\n        messageArea.innerHTML = '<div class=\"text-center my-3\"><span class=\"text-xs px-3 py-1.5 rounded-full bg-[var(--bg-accent)] text-[var(--text-secondary)] shadow-sm glassmorphism border-none\">聊天记录已清空</span></div>';\n        const cv = JSON.parse(localStorage.getItem(STORAGE_KEY_MESSAGES)) || {};\n        if (cv[conversationContextId]) {\n            delete cv[conversationContextId];\n            localStorage.setItem(STORAGE_KEY_MESSAGES, JSON.stringify(cv));\n        }\n        showToast('聊天记录已清空', 'info', 2000);\n        if (toastTimeout) clearTimeout(toastTimeout);\n        toastNotification.style.opacity = '0';\n    });\n    document.getElementById('cancelClear')?.addEventListener('click', () => {\n        if (toastTimeout) clearTimeout(toastTimeout);\n        toastNotification.style.opacity = '0';\n    });\n}\n\nfunction clearConversationContext() {\n    conversationContextId = Date.now().toString();\n    currentConversationHistory = [];\n    messageArea.innerHTML = '<div class=\"text-center my-3\"><span class=\"text-xs px-3 py-1.5 rounded-full bg-[var(--bg-accent)] text-[var(--text-secondary)] shadow-sm glassmorphism border-none\">新对话已开始 (上下文已重置)</span></div>';\n    showToast('新对话已开始 (上下文已重置)', 'info', 2500);\n}\n\nfunction renderUserList() {\n    userList.innerHTML = '';\n    const iL = document.documentElement.classList.contains('light');\n    const uAB = iL ? \"3b82f6\" : \"6a82fb\";\n    const uAT = iL ? \"ffffff\" : \"e0e7ff\";\n    const aAB = iL ? \"10b981\" : \"2dd4bf\";\n    const aAT = iL ? \"ffffff\" : \"0d0f1a\";\n    userList.appendChild(createUserListItem(currentUsername, currentUserAvatarChar, 'online', false, uAB, uAT));\n    userList.appendChild(createUserListItem(AI_ASSISTANT_NAME, AI_AVATAR_CHAR, 'online', true, aAB, aAT));\n}\n\nfunction createUserListItem(n, aC, s, iB, aB, aT) {\n    const li = document.createElement('li');\n    li.className = 'user-list-item flex items-center p-2.5 rounded-lg hover:bg-[var(--bg-accent)] transition duration-150 cursor-pointer group';\n    li.dataset.username = n; li.dataset.isBot = iB;\n    const av = document.createElement('img');\n    av.src = getAvatarUrl(aC, \"40x40\", aB, aT);\n    av.alt = n; av.className = 'w-9 h-9 rounded-full mr-3 flex-shrink-0 shadow-sm';\n    const nS = document.createElement('span');\n    nS.className = 'text-sm font-medium text-[var(--text-primary)] truncate group-hover:text-[var(--text-accent)]';\n    nS.textContent = n;\n    const sI = document.createElement('span');\n    sI.className = `ml-auto w-2.5 h-2.5 rounded-full flex-shrink-0 border-2 border-[var(--bg-secondary)] ${s==='online'?(iB?'bg-sky-400':'bg-green-400 animate-pulseGlow'):'bg-gray-400'}`;\n    if (iB && s === 'online') sI.style.setProperty('--shadow-glow', 'rgba(56,189,248,0.5)');\n    else if (!iB && s === 'online') sI.style.setProperty('--shadow-glow', 'rgba(74,222,128,0.5)');\n    li.appendChild(av); li.appendChild(nS); li.appendChild(sI);\n    li.style.cursor = 'default';\n    return li;\n}\n\nfunction showTypingIndicator() {\n    if (typingIndicator.children.length === 0) {\n        const iE = document.createElement('span');\n        iE.innerHTML = `<svg class=\"animate-spin h-4 w-4 mr-1.5 text-[var(--text-accent)] inline-block\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg> ${AI_ASSISTANT_NAME} 正在解码信息`;\n        typingIndicator.appendChild(iE);\n    }\n}\n\nfunction hideTypingIndicator() {\n    typingIndicator.innerHTML = '';\n}\n\nfunction populateEmojiPicker() {\n    EMOJIS.forEach(e => {\n        const eS = document.createElement('span');\n        eS.textContent = e;\n        eS.className = \"p-1.5 rounded-md hover:bg-[var(--bg-accent)] transition-colors text-2xl cursor-pointer\";\n        eS.addEventListener('click', () => insertEmoji(e));\n        emojiPicker.appendChild(eS);\n    });\n}\n\nfunction toggleEmojiPicker(fS) {\n    const sO = fS !== undefined ? fS : emojiPicker.classList.contains('hidden');\n    if (sO) {\n        emojiPicker.classList.remove('hidden'); isEmojiPickerOpen = true;\n        setTimeout(() => document.addEventListener('click', handleClickOutsideEmojiPicker, true), 0);\n    } else {\n        emojiPicker.classList.add('hidden'); isEmojiPickerOpen = false;\n        document.removeEventListener('click', handleClickOutsideEmojiPicker, true);\n    }\n}\n\nfunction insertEmoji(e) {\n    const { selectionStart: sS, selectionEnd: sE, value: v } = messageInput;\n    messageInput.value = v.substring(0, sS) + e + v.substring(sE);\n    messageInput.focus();\n    messageInput.setSelectionRange(sS + e.length, sS + e.length);\n    adjustTextareaHeight();\n    sendButton.disabled = messageInput.value.trim() === '';\n}\n\nfunction handleClickOutsideEmojiPicker(ev) {\n    if (!emojiPicker.contains(ev.target) && ev.target !== emojiButton && !emojiButton.contains(ev.target)) toggleEmojiPicker(false);\n}\n\nfunction adjustTextareaHeight() {\n    messageInput.style.height = 'auto';\n    let nH = Math.max(50, Math.min(messageInput.scrollHeight + 2, 180));\n    messageInput.style.height = `${nH}px`;\n}\n\nfunction renderCustomBodyParamsList() {\n    customBodyParamsList.innerHTML = '';\n    if (!apiConfig.customBodyParams || apiConfig.customBodyParams.length === 0) {\n        customBodyParamsList.innerHTML = '<p class=\"text-xs text-[var(--text-secondary)] italic\">尚无自定义参数。</p>';\n        return;\n    }\n    apiConfig.customBodyParams.forEach((p, i) => {\n        const it = document.createElement('div');\n        it.className = 'custom-body-param-item flex items-center gap-2 p-2 bg-[var(--bg-accent)] border border-[var(--border-accent)] rounded-md animate-fadeIn';\n        it.innerHTML = `<span class=\"key font-mono text-xs text-[var(--text-accent)]\">${p.key}:</span><span class=\"value flex-grow font-mono text-xs text-[var(--text-secondary)] overflow-hidden text-ellipsis whitespace-nowrap\" title=\"${p.value}\">${p.value}</span><button type=\"button\" class=\"btn-remove-param btn !p-1 !text-xs !bg-transparent !text-[var(--error-color)] hover:!bg-[var(--error-color)] hover:!text-white\" data-index=\"${i}\" title=\"移除\"><i class=\"fas fa-times\"></i></button>`;\n        it.querySelector('.btn-remove-param').addEventListener('click', (e) => removeCustomBodyParam(parseInt(e.currentTarget.dataset.index)));\n        customBodyParamsList.appendChild(it);\n    });\n}\n\nfunction addCustomBodyParam() {\n    const k = customBodyKeyInput.value.trim();\n    const v = customBodyValueInput.value.trim();\n    if (!k) {\n        showSettingsStatus('参数名 (Key) 不能为空。', 'error'); customBodyKeyInput.focus(); return;\n    }\n    if (!v) {\n        showSettingsStatus('参数值 (Value) 不能为空。', 'error'); customBodyValueInput.focus(); return;\n    }\n    try { JSON.parse(v); }\n    catch (e) {\n        if (!confirm('参数值不是有效的JSON。字符串需要用引号包裹。要作为普通字符串添加吗？')) {\n             showSettingsStatus('操作已取消。', 'info'); customBodyValueInput.focus(); return;\n        }\n    }\n    if (!Array.isArray(apiConfig.customBodyParams)) apiConfig.customBodyParams = [];\n    apiConfig.customBodyParams.push({ key: k, value: v });\n    renderCustomBodyParamsList();\n    saveConfig();\n    customBodyKeyInput.value = ''; customBodyValueInput.value = '';\n    showSettingsStatus(`参数 \"${k}\" 已添加。`, 'success');\n}\n\nfunction removeCustomBodyParam(idx) {\n    if (apiConfig.customBodyParams?.[idx]) {\n        const rm = apiConfig.customBodyParams.splice(idx, 1)[0];\n        renderCustomBodyParamsList(); saveConfig();\n        showSettingsStatus(`参数 \"${rm.key}\" 已移除。`, 'info');\n    }\n}\n\nfunction initializeChat() {\n    loadConfig();\n    const savedUsername = settingsUsernameInput.value.trim();\n    if (savedUsername) {\n        currentUsername = savedUsername;\n        currentUserAvatarChar = currentUsername.charAt(0)?.toUpperCase() || 'O';\n    }\n    usernameHeader.textContent = currentUsername;\n    \n    const isLight = localStorage.getItem(STORAGE_KEY_THEME) === 'light';\n    applyTheme(isLight);\n\n    if (!loadConversationFromStorage()) {\n        messageArea.innerHTML = '<div class=\"text-center my-3\"><span class=\"text-xs px-3 py-1.5 rounded-full bg-[var(--bg-accent)] text-[var(--text-secondary)] shadow-sm glassmorphism border-none\">开始与AI交流</span></div>';\n    }\n    renderUserList();\n    navigateTo('chatPage');\n    messageInput.focus();\n}\n\nfunction initializeApp() {\n    console.log(\"Initializing AI Stardust Chat Add-in...\");\n    \n    configureMarkdown();\n    populateEmojiPicker();\n    initializeChat();\n\n    sendButton.addEventListener('click', sendMessage);\n    messageInput.addEventListener('keypress', (e) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            if (!sendButton.disabled) sendMessage();\n        }\n    });\n    messageInput.addEventListener('input', () => {\n        adjustTextareaHeight();\n        sendButton.disabled = messageInput.value.trim() === '' || abortController != null;\n    });\n    stopGeneratingButton.addEventListener('click', stopGeneration);\n    settingsButton.addEventListener('click', () => navigateTo('settingsPage'));\n    profileButton.addEventListener('click', () => showToast('个人信息功能已简化。请在设置中修改您的代号。', 'info'));\n    closeSettingsButton.addEventListener('click', () => navigateTo('chatPage'));\n\n    apiSettingsForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const newUsername = settingsUsernameInput.value.trim();\n        if (newUsername && newUsername !== currentUsername) {\n            currentUsername = newUsername;\n            currentUserAvatarChar = newUsername.charAt(0)?.toUpperCase() || 'O';\n            usernameHeader.textContent = currentUsername;\n            applyTheme(document.documentElement.classList.contains('light'));\n            renderUserList();\n        } else if (!newUsername) {\n            showSettingsStatus('代号不能为空！', 'error');\n            return;\n        }\n\n        apiConfig.provider = document.querySelector('input[name=\"apiProvider\"]:checked')?.value || 'gemini';\n        apiConfig.apiKey = settingsApiKeyInput.value.trim();\n\n        if (apiConfig.provider === 'custom') apiConfig.apiUrl = settingsApiUrlInput.value.trim();\n        else updateApiUrlForProvider(apiConfig.provider, false);\n\n        apiConfig.models = settingsModelListInput.value.split(',').map(m => m.trim()).filter(Boolean);\n        apiConfig.defaultModel = settingsModelSelect.value;\n        apiConfig.streaming = settingsStreamingEnabled.checked;\n        apiConfig.reasoning = (apiConfig.provider === 'deepseek') ? settingsReasoningEnabled.checked : false;\n        apiConfig.aiStyle = aiStyleSelect.value;\n        apiConfig.aiStyleStrength = parseFloat(aiStyleStrength.value);\n\n        if (!apiConfig.apiKey) { showSettingsStatus('API 密钥不能为空！', 'error'); settingsApiKeyInput.focus(); return; }\n        if (apiConfig.provider === 'custom' && !apiConfig.apiUrl) { showSettingsStatus('自定义 API 地址不能为空！', 'error'); settingsApiUrlInput.focus(); return; }\n        if (apiConfig.models.length === 0) { showSettingsStatus('可用模型列表不能为空！', 'error'); settingsModelListInput.focus(); return; }\n        if (!apiConfig.defaultModel && apiConfig.models.length > 0) {\n            apiConfig.defaultModel = apiConfig.models[0];\n            settingsModelSelect.value = apiConfig.defaultModel;\n        } else if (!apiConfig.defaultModel && apiConfig.models.length === 0) {\n            showSettingsStatus('请选择或获取一个默认模型！', 'error');\n            settingsModelSelect.focus();\n            return;\n        }\n\n        if (saveConfig()) {\n            showSettingsStatus('配置已成功应用并保存！', 'success');\n            updateModelSelectDropdown();\n        } else showSettingsStatus('保存配置时出错。', 'error');\n    });\n\n    apiProviderRadios.forEach(radio => radio.addEventListener('change', (e) => {\n        apiConfig.provider = e.target.value;\n        updateApiUrlForProvider(apiConfig.provider, false);\n        updateApiUrlVisibility();\n        apiConfig.models = []; apiConfig.defaultModel = '';\n        settingsModelListInput.value = ''; updateModelSelectDropdown();\n    }));\n\n    settingsModelListInput.addEventListener('input', () => {\n        apiConfig.models = settingsModelListInput.value.split(',').map(m => m.trim()).filter(Boolean);\n        updateModelSelectDropdown();\n        if (apiConfig.defaultModel && !apiConfig.models.includes(apiConfig.defaultModel) && apiConfig.models.length > 0) {\n            settingsModelSelect.value = apiConfig.models[0];\n            apiConfig.defaultModel = apiConfig.models[0];\n        } else if (apiConfig.models.length === 0) {\n            settingsModelSelect.value = ''; apiConfig.defaultModel = '';\n        }\n    });\n\n    fetchModelsButton.addEventListener('click', fetchModels);\n    clearChatButton.addEventListener('click', clearCurrentConversation);\n    clearContextButton.addEventListener('click', clearConversationContext);\n    themeToggleButton.addEventListener('click', toggleTheme);\n    darkModeToggle.addEventListener('change', () => {\n        applyTheme(darkModeToggle.checked);\n        localStorage.setItem(STORAGE_KEY_THEME, darkModeToggle.checked ? 'light' : 'dark');\n    });\n    emojiButton.addEventListener('click', (event) => { event.stopPropagation(); toggleEmojiPicker(); });\n    addCustomBodyParamButton.addEventListener('click', addCustomBodyParam);\n\n    getSelectionButton.addEventListener('click', getSelectedContent);\n\n    console.log(\"AI Stardust Chat Add-in loaded successfully.\");\n}","// Imports\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\nvar ___HTML_LOADER_IMPORT_1___ = new URL(\"./taskpane.js\", import.meta.url);\n// Module\nvar code = \"<!DOCTYPE html> <html lang=\\\"zh-CN\\\"> <head> <meta charset=\\\"UTF-8\\\"> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>AI聊天室 V4.1 - 星尘</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.tailwindcss.com\\\"><\" + \"/script> <link rel=\\\"preconnect\\\" href=\\\"https://fonts.googleapis.com\\\"> <link rel=\\\"preconnect\\\" href=\\\"https://fonts.gstatic.com\\\" crossorigin> <link href=\\\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700&display=swap\\\" rel=\\\"stylesheet\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css\\\" integrity=\\\"sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==\\\" crossorigin=\\\"anonymous\\\" referrerpolicy=\\\"no-referrer\\\"/> <link rel=\\\"stylesheet\\\" href=\\\"https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css\\\"> <link href=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css\\\" rel=\\\"stylesheet\\\"> <link href=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css\\\" rel=\\\"stylesheet\\\"> <link href=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.css\\\" rel=\\\"stylesheet\\\"> <link rel=\\\"stylesheet\\\" href=\\\"\" + ___HTML_LOADER_IMPORT_0___ + \"\\\"> </head> <body class=\\\"h-screen flex items-center justify-center p-0 overflow-hidden\\\"> <div id=\\\"appContainer\\\" class=\\\"relative w-full h-full md:max-w-full md:h-full md:rounded-none overflow-hidden\\\"> <div id=\\\"chatPage\\\" class=\\\"page flex flex-col w-full h-full\\\"> <header class=\\\"header flex justify-between items-center flex-shrink-0\\\"> <h1 class=\\\"text-xl md:text-2xl font-bold flex items-center\\\"> <i class=\\\"fas fa-satellite-dish mr-3 text-[var(--text-accent)] animate-pulseGlow\\\" style=\\\"animation-duration:3s\\\"></i> AI 星尘 </h1> <div class=\\\"flex items-center space-x-2 md:space-x-3\\\"> <button id=\\\"themeToggleButton\\\" class=\\\"icon-button\\\" title=\\\"切换主题 (暗/亮)\\\"> <i class=\\\"fas fa-sun\\\"></i> </button> <button id=\\\"settingsButton\\\" class=\\\"icon-button\\\" title=\\\"应用设置\\\"> <i class=\\\"fas fa-cogs\\\"></i> </button> <div class=\\\"relative group\\\"> <button id=\\\"profileButton\\\" class=\\\"flex items-center space-x-2 py-1 px-2 rounded-full hover:bg-[rgba(255,255,255,0.05)] transition duration-150\\\"> <img id=\\\"userAvatarHeader\\\" src=\\\"https://placehold.co/36x36/82a9ff/0d0f1a?text=O&font=orbitron\\\" alt=\\\"用户头像\\\" class=\\\"w-8 h-8 rounded-full border-2 border-[var(--text-accent)] shadow-md group-hover:scale-105 transition-transform\\\"> <span id=\\\"usernameHeader\\\" class=\\\"text-sm font-semibold hidden md:inline text-[var(--text-primary-dark)]\\\">Office User</span> </button> </div> </div> </header> <div class=\\\"flex flex-grow overflow-hidden\\\"> <aside class=\\\"user-list-panel flex-shrink-0 overflow-y-auto transition-all duration-300 ease-in-out\\\"> <h2 class=\\\"text-lg font-semibold mb-5 pb-2 border-b-2\\\"> <i class=\\\"fas fa-users-cog mr-2\\\"></i>在线频道 </h2> <ul id=\\\"userList\\\" class=\\\"space-y-3\\\"></ul> </aside> <main class=\\\"flex-grow flex flex-col transition-colors duration-300\\\"> <div id=\\\"messageArea\\\" class=\\\"flex-grow overflow-y-auto space-y-5 scroll-smooth\\\"> <div class=\\\"text-center my-3\\\"> <span class=\\\"text-xs px-3 py-1.5 rounded-full bg-[var(--bg-accent)] text-[var(--text-secondary)] shadow-sm glassmorphism border-none\\\">对话已准备就绪 | 开始与AI交流</span> </div> </div> <div id=\\\"typingIndicator\\\" class=\\\"h-7 px-6 pb-1 text-sm text-[var(--text-secondary)] italic flex items-center space-x-2\\\"></div> <div class=\\\"message-input-area flex items-center space-x-3 flex-shrink-0\\\"> <button id=\\\"stopGeneratingButton\\\" class=\\\"btn btn-danger !p-2.5 !rounded-full\\\" style=\\\"display:none\\\"> <i class=\\\"fas fa-stop text-lg\\\"></i> </button> <button id=\\\"getSelectionButton\\\" class=\\\"icon-button text-xl p-3 rounded-full hover:bg-[var(--input-bg)] self-center\\\" title=\\\"获取文档中选中的内容\\\"> <i class=\\\"fas fa-file-import\\\"></i> </button> <div class=\\\"relative flex-grow\\\"> <textarea id=\\\"messageInput\\\" placeholder=\\\"输入指令或信息 (Shift+Enter 换行)...\\\" class=\\\"w-full focus:outline-none block\\\" rows=\\\"1\\\"></textarea> <button id=\\\"emojiButton\\\" class=\\\"absolute icon-button text-xl p-2 rounded-full\\\" title=\\\"表情符号\\\"> <i class=\\\"far fa-grin-beam\\\"></i> </button> </div> <button id=\\\"sendButton\\\" class=\\\"btn btn-primary !rounded-xl self-stretch\\\" disabled=\\\"disabled\\\"> <span class=\\\"hidden md:inline\\\">发送</span> <i class=\\\"fas fa-paper-plane-top fas fa-location-arrow ml-0 md:ml-1.5\\\"></i> </button> <div id=\\\"emojiPicker\\\" class=\\\"emoji-picker hidden glassmorphism\\\"></div> </div> </main> </div> </div> <div id=\\\"settingsPage\\\" class=\\\"page hidden overflow-y-auto\\\"> <div class=\\\"max-w-3xl mx-auto py-8 px-4 md:px-0\\\"> <div class=\\\"flex items-center justify-between mb-10\\\"> <h2 class=\\\"text-4xl font-bold\\\"><i class=\\\"fas fa-atom mr-3 text-[var(--text-accent)]\\\"></i>参数配置中心</h2> <button id=\\\"closeSettingsButton\\\" class=\\\"icon-button text-3xl\\\" title=\\\"返回聊天\\\"> <i class=\\\"fas fa-times-circle opacity-70 hover:opacity-100\\\"></i> </button> </div> <div class=\\\"status-indicator fixed top-5 right-5 z-[100] glassmorphism !p-3 !rounded-xl\\\" id=\\\"settingsStatusIndicator\\\" style=\\\"display:none\\\"></div> <form id=\\\"apiSettingsForm\\\" class=\\\"space-y-10\\\"> <div class=\\\"settings-section\\\"> <h3 class=\\\"settings-section-header\\\"><i class=\\\"fas fa-network-wired\\\"></i> AI 核心连接</h3> <div class=\\\"api-provider grid grid-cols-2 md:grid-cols-4 gap-3 mb-6\\\"> <label class=\\\"flex items-center space-x-2 p-3 border border-[var(--border-accent)] rounded-lg cursor-pointer hover:bg-[var(--bg-accent)] has-[:checked]:bg-[var(--bg-accent)] has-[:checked]:border-[var(--text-accent)] has-[:checked]:shadow-lg\\\"> <input type=\\\"radio\\\" name=\\\"apiProvider\\\" value=\\\"deepseek\\\" class=\\\"sr-only\\\"> <i class=\\\"fas fa-brain provider-icon text-purple-400\\\"></i> <span class=\\\"font-medium\\\">DeepSeek</span></label> <label class=\\\"flex items-center space-x-2 p-3 border border-[var(--border-accent)] rounded-lg cursor-pointer hover:bg-[var(--bg-accent)] has-[:checked]:bg-[var(--bg-accent)] has-[:checked]:border-[var(--text-accent)] has-[:checked]:shadow-lg\\\"> <input type=\\\"radio\\\" name=\\\"apiProvider\\\" value=\\\"openai\\\" class=\\\"sr-only\\\"> <i class=\\\"fab fa-openai provider-icon text-teal-400\\\"></i> <span class=\\\"font-medium\\\">OpenAI</span></label> <label class=\\\"flex items-center space-x-2 p-3 border border-[var(--border-accent)] rounded-lg cursor-pointer hover:bg-[var(--bg-accent)] has-[:checked]:bg-[var(--bg-accent)] has-[:checked]:border-[var(--text-accent)] has-[:checked]:shadow-lg\\\"> <input type=\\\"radio\\\" name=\\\"apiProvider\\\" value=\\\"gemini\\\" class=\\\"sr-only\\\"> <svg class=\\\"provider-icon text-blue-400\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"><path d=\\\"M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16zm-2.29-5.29L12 17.01l2.29-2.3a1 1 0 00-1.41-1.41L12 14.18l-.88-.88a1 1 0 10-1.41 1.41zM12 6.99l-2.29 2.3a1 1 0 101.41 1.41L12 9.82l.88.88a1 1 0 101.41-1.41L12 6.99z\\\"/></svg> <span class=\\\"font-medium\\\">Gemini</span></label> <label class=\\\"flex items-center space-x-2 p-3 border border-[var(--border-accent)] rounded-lg cursor-pointer hover:bg-[var(--bg-accent)] has-[:checked]:bg-[var(--bg-accent)] has-[:checked]:border-[var(--text-accent)] has-[:checked]:shadow-lg\\\"> <input type=\\\"radio\\\" name=\\\"apiProvider\\\" value=\\\"custom\\\" class=\\\"sr-only\\\"> <i class=\\\"fas fa-server provider-icon text-gray-400\\\"></i> <span class=\\\"font-medium\\\">自定义</span></label> </div> <div class=\\\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5\\\"> <div class=\\\"form-group md:col-span-2\\\"> <label for=\\\"settingsApiKey\\\"><i class=\\\"fas fa-key mr-1 opacity-70\\\"></i> API 密钥 (机密)</label> <input type=\\\"password\\\" id=\\\"settingsApiKey\\\" placeholder=\\\"在此输入您的API密钥\\\"> </div> <div class=\\\"form-group md:col-span-2\\\" id=\\\"settingsApiUrlGroup\\\" style=\\\"display:none\\\"> <label for=\\\"settingsApiUrl\\\"><i class=\\\"fas fa-link mr-1 opacity-70\\\"></i> API 端点地址</label> <input type=\\\"url\\\" id=\\\"settingsApiUrl\\\" placeholder=\\\"例如：https://your-proxy.com/v1\\\"> </div> </div> <div class=\\\"form-group md:col-span-2\\\" id=\\\"settingsDefaultApiUrls\\\"> <label><i class=\\\"fas fa-info-circle mr-1 opacity-70\\\"></i> 预设 API 地址</label> <div class=\\\"mt-1 text-xs text-[var(--text-secondary)] p-3 bg-[var(--bg-accent)] rounded-md border border-[var(--border-color)]\\\"> <span id=\\\"settingsDeepseekUrl\\\" class=\\\"block\\\"><i class=\\\"fas fa-brain mr-1\\\"></i> DeepSeek: https://api.deepseek.com/v1</span> <span id=\\\"settingsOpenaiUrl\\\" style=\\\"display:none\\\" class=\\\"block\\\"><i class=\\\"fab fa-openai mr-1\\\"></i> OpenAI: https://api.openai.com/v1</span> <span id=\\\"settingsGeminiUrl\\\" style=\\\"display:none\\\" class=\\\"block\\\"><svg class=\\\"provider-icon text-blue-400 inline-block\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"><path d=\\\"M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16zm-2.29-5.29L12 17.01l2.29-2.3a1 1 0 00-1.41-1.41L12 14.18l-.88-.88a1 1 0 10-1.41 1.41zM12 6.99l-2.29 2.3a1 1 0 101.41 1.41L12 9.82l.88.88a1 1 0 101.41-1.41L12 6.99z\\\"/></svg> Gemini: https://generativelanguage.googleapis.com/v1beta/models/</span> </div> </div> <div class=\\\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 mt-4\\\"> <div class=\\\"form-group\\\"> <label for=\\\"settingsModelList\\\"><i class=\\\"fas fa-microchip mr-1 opacity-70\\\"></i> 可用模型 (逗号分隔)</label> <input type=\\\"text\\\" id=\\\"settingsModelList\\\" placeholder=\\\"deepseek-chat, gpt-4, gemini-1.5-flash-latest\\\"> </div> <div class=\\\"form-group\\\"> <label for=\\\"settingsModelSelect\\\"><i class=\\\"fas fa-check-circle mr-1 opacity-70\\\"></i> 默认模型</label> <select id=\\\"settingsModelSelect\\\"> <option value=\\\"\\\">-- 请先填入或获取模型 --</option> </select> </div> </div> <div class=\\\"form-group md:col-span-2 text-right mt-3\\\"> <button type=\\\"button\\\" id=\\\"fetchModelsButton\\\" class=\\\"btn btn-secondary text-sm py-2 px-4\\\"> <i class=\\\"fas fa-cloud-download-alt\\\"></i> 自动获取模型 </button> </div> <div class=\\\"streaming-option mt-3\\\"> <input type=\\\"checkbox\\\" id=\\\"settingsStreamingEnabled\\\" checked=\\\"checked\\\" class=\\\"form-checkbox h-5 w-5 rounded\\\"> <label for=\\\"settingsStreamingEnabled\\\" class=\\\"ml-2 text-sm\\\"><i class=\\\"fas fa-stream mr-1 opacity-70\\\"></i> 启用流式输出 (实时显示)</label> </div> <div class=\\\"form-group mt-4\\\" id=\\\"reasoningOptionContainer\\\"> <label class=\\\"text-sm\\\"><i class=\\\"fas fa-project-diagram mr-1 opacity-70\\\"></i> 高级选项</label> <div class=\\\"streaming-option\\\"> <input type=\\\"checkbox\\\" id=\\\"settingsReasoningEnabled\\\" class=\\\"form-checkbox h-5 w-5 rounded\\\"> <label for=\\\"settingsReasoningEnabled\\\" class=\\\"ml-2 text-sm\\\">启用推理模型 (若服务商支持)</label> </div> <p class=\\\"text-xs text-[var(--text-secondary)] mt-1\\\">特定服务商（如DeepSeek）可能提供详细推理过程。</p> </div> </div> <div class=\\\"settings-section\\\" id=\\\"customApiSettingsSection\\\" style=\\\"display:none\\\"> <h3 class=\\\"settings-section-header\\\"><i class=\\\"fas fa-sliders-h\\\"></i> 自定义 API 请求参数</h3> <p class=\\\"text-sm text-[var(--text-secondary)] mb-4\\\">为 \\\"自定义\\\" API Provider 添加额外的请求体参数。模型和消息列表会自动包含。</p> <div class=\\\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4\\\"> <div class=\\\"form-group\\\"> <label for=\\\"customBodyKey\\\">参数名 (Key)</label> <input type=\\\"text\\\" id=\\\"customBodyKey\\\" placeholder=\\\"例如：temperature\\\"> </div> <div class=\\\"form-group\\\"> <label for=\\\"customBodyValue\\\">参数值 (JSON)</label> <textarea id=\\\"customBodyValue\\\" rows=\\\"2\\\" placeholder='例如：0.7 或 {\\\"max_tokens\\\": 100}'></textarea> </div> </div> <button type=\\\"button\\\" id=\\\"addCustomBodyParamButton\\\" class=\\\"btn btn-secondary text-sm py-2 px-4\\\"> <i class=\\\"fas fa-plus-circle\\\"></i> 添加参数 </button> <div id=\\\"customBodyParamsList\\\" class=\\\"mt-4 space-y-2\\\"></div> </div> <div class=\\\"settings-section\\\"> <h3 class=\\\"settings-section-header\\\"><i class=\\\"fas fa-palette\\\"></i> AI 风格与个性化</h3> <div class=\\\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5\\\"> <div class=\\\"form-group\\\"> <label for=\\\"aiStyleSelect\\\"><i class=\\\"fas fa-paint-brush mr-1 opacity-70\\\"></i> AI 回复风格</label> <select id=\\\"aiStyleSelect\\\" class=\\\"w-full\\\"> <option value=\\\"default\\\">默认 (平衡)</option> <option value=\\\"professional\\\">专业严谨</option> <option value=\\\"friendly\\\">友好亲切</option> <option value=\\\"humorous\\\">幽默风趣</option> <option value=\\\"concise\\\">简洁直接</option> <option value=\\\"detailed\\\">详细全面</option> </select> </div> <div class=\\\"form-group\\\"> <label for=\\\"aiStyleStrength\\\"><i class=\\\"fas fa-sliders-h mr-1 opacity-70\\\"></i> 风格强度</label> <input type=\\\"range\\\" id=\\\"aiStyleStrength\\\" min=\\\"0.5\\\" max=\\\"2\\\" step=\\\"0.1\\\" value=\\\"1\\\" class=\\\"w-full h-2 bg-[var(--border-accent)] rounded-lg appearance-none cursor-pointer accent-[var(--text-accent)]\\\"> <div class=\\\"flex justify-between text-xs text-[var(--text-secondary)] mt-1\\\"> <span>柔和</span><span>适中</span><span>强烈</span> </div> </div> <div class=\\\"form-group md:col-span-2\\\"> <label for=\\\"settingsUsernameInput\\\"><i class=\\\"fas fa-user-astronaut mr-1 opacity-70\\\"></i> 您的代号 (仅用于显示)</label> <input type=\\\"text\\\" id=\\\"settingsUsernameInput\\\" value=\\\"Office User\\\" placeholder=\\\"星际探险家\\\"> </div> </div> </div> <div class=\\\"settings-section\\\"> <h3 class=\\\"settings-section-header\\\"><i class=\\\"fas fa-desktop\\\"></i> 外观与管理</h3> <div class=\\\"flex items-center justify-between mb-6 py-3 border-y border-[var(--border-accent)]\\\"> <span class=\\\"text-sm font-medium text-[var(--text-primary)] flex items-center\\\"><i class=\\\"fas fa-adjust mr-2 opacity-70\\\"></i> 主题模式 (暗/亮)</span> <label for=\\\"darkModeToggle\\\" class=\\\"inline-flex relative items-center cursor-pointer\\\"> <input type=\\\"checkbox\\\" value=\\\"\\\" id=\\\"darkModeToggle\\\" class=\\\"sr-only peer\\\"> <div class=\\\"w-11 h-6 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[var(--input-focus-ring)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all\\\"></div> </label> </div> <div class=\\\"context-buttons grid grid-cols-2 gap-4\\\"> <button type=\\\"button\\\" id=\\\"clearContextButton\\\" class=\\\"btn btn-secondary w-full\\\"> <i class=\\\"fas fa-broom\\\"></i> 清除当前对话上下文 </button> <button type=\\\"button\\\" id=\\\"clearChatButton\\\" class=\\\"btn btn-danger w-full border-red-500/70 text-red-500 hover:bg-red-600 hover:text-white dark:hover:bg-red-700\\\"> <i class=\\\"fas fa-trash-alt\\\"></i> 清空所有聊天记录 </button> </div> <p class=\\\"text-xs text-[var(--text-secondary)] mt-3\\\">\\\"清除上下文\\\"将开始新话题但保留记录，\\\"清空记录\\\"将删除所有本地存储的聊天记录。</p> </div> <div class=\\\"mt-12 text-center\\\"> <button type=\\\"submit\\\" id=\\\"saveSettingsButton\\\" class=\\\"btn btn-primary text-base py-3 px-8\\\"> <i class=\\\"fas fa-save\\\"></i> 应用并保存配置 </button> </div> </form> </div> </div> <div id=\\\"toastNotification\\\" class=\\\"fixed bottom-6 right-6 z-[200] text-white\\\"></div> </div> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/marked@6.0.0/lib/marked.umd.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"\" + ___HTML_LOADER_IMPORT_1___ + \"\\\"><\" + \"/script> </body> </html>\";\n// Exports\nexport default code;"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","g","globalThis","this","Function","e","window","o","obj","prop","Object","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","tagName","toUpperCase","src","scripts","getElementsByTagName","length","i","test","Error","replace","p","b","baseURI","self","href","t","r","Symbol","n","iterator","toStringTag","c","Generator","u","create","_regeneratorDefine2","f","y","G","v","a","d","bind","l","TypeError","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","defineProperty","enumerable","configurable","writable","_invoke","_typeof","constructor","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","name","_unsupportedIterableToArray","_nonIterableSpread","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","toPrimitive","String","_toPrimitive","_toPropertyKey","Office","onReady","info","host","HostType","Word","Excel","PowerPoint","console","log","marked","setOptions","breaks","gfm","highlight","code","lang","language","Prism","languages","renderer","Renderer","infostring","escaped","match","highlightedCode","options","langClass","concat","langPrefix","originalParagraph","paragraph","text","formula","katex","renderToString","throwOnError","displayMode","message","trim","use","configureMarkdown","EMOJIS","eS","createElement","textContent","className","addEventListener","sS","messageInput","selectionStart","sE","selectionEnd","substring","focus","setSelectionRange","adjustTextareaHeight","sendButton","disabled","insertEmoji","emojiPicker","appendChild","savedConfig","localStorage","getItem","STORAGE_KEY_CONFIG","parsedConfig","JSON","parse","apiConfig","models","customBodyParams","error","showToast","removeItem","provider","updateApiUrlForProvider","apiUrl","_currentUsername$char","savedUsername","settingsUsernameInput","currentUserAvatarChar","currentUsername","charAt","usernameHeader","updateModelSelectDropdown","renderCustomBodyParamsList","loadConfig","_currentUsername$char2","applyTheme","STORAGE_KEY_THEME","STORAGE_KEY_MESSAGES","conversationContextId","cv","currentConversationHistory","messageArea","innerHTML","role","displayMessage","content","AI_ASSISTANT_NAME","AI_AVATAR_CHAR","scrollToBottom","loadConversationFromStorage","renderUserList","navigateTo","initializeChat","sendMessage","key","shiftKey","preventDefault","abortController","stopGeneratingButton","stopGeneration","settingsButton","profileButton","closeSettingsButton","apiSettingsForm","_document$querySelect2","_newUsername$charAt","newUsername","documentElement","classList","contains","showSettingsStatus","querySelector","apiKey","settingsApiKeyInput","settingsApiUrlInput","settingsModelListInput","split","map","Boolean","defaultModel","settingsModelSelect","streaming","settingsStreamingEnabled","checked","reasoning","settingsReasoningEnabled","aiStyle","aiStyleSelect","aiStyleStrength","parseFloat","saveConfig","apiProviderRadios","radio","target","updateApiUrlVisibility","includes","fetchModelsButton","fetchModels","clearChatButton","clearCurrentConversation","clearContextButton","clearConversationContext","themeToggleButton","toggleTheme","darkModeToggle","setItem","emojiButton","event","stopPropagation","toggleEmojiPicker","addCustomBodyParamButton","addCustomBodyParam","getSelectionButton","getSelectedContent","toastTimeout","MAX_MESSAGES_DISPLAY","MAX_HISTORY_SENT_TO_API","getElementById","userList","userAvatarHeader","themeToggleIcon","typingIndicator","settingsStatusIndicator","querySelectorAll","settingsApiUrlGroup","settingsDefaultApiUrls","settingsDeepseekUrl","settingsOpenaiUrl","settingsGeminiUrl","reasoningOptionContainer","customApiSettingsSection","customBodyKeyInput","customBodyValueInput","customBodyParamsList","toastNotification","isEmojiPickerOpen","Date","now","getAvatarUrl","char","size","bgColor","textColor","font","canvas","ctx","getContext","dpr","devicePixelRatio","sizePx","parseInt","width","height","fillStyle","fillRect","textAlign","textBaseline","fillText","toDataURL","encodeURIComponent","setTimeout","scrollTo","top","scrollHeight","behavior","type","duration","clearTimeout","iconClass","remove","style","backgroundColor","color","requestAnimationFrame","opacity","transform","targetPageId","page","id","add","providerRadio","join","loadSettingsToUI","isLight","htmlEl","highlightAll","toggle","shouldSaveConfig","stringify","_document$querySelect","selectedProvider","display","model","option","defaultOption","highlightCodeInElement","element","highlightAllUnder","body","pre","getAttribute","codeElement","actionButton","position","right","zIndex","toLowerCase","context","onclick","rawCode","innerText","insertContent","insertCodeOrFormula","prismToolbar","renderMessageContent","rawContent","htmlContent","DOMPurify","sanitize","USE_PROFILES","html","ADD_TAGS","ADD_ATTR","sender","isOwnMessage","avatarChar","messageId","reasoningContent","msgId","Math","random","existingMessageElement","bubble","textElement","reasoningElement","insertBefore","messageElement","avatarColorIsLight","avatarBg","avatarText","avatarElement","alt","messageContentWrapper","actionsContainer","insertBtn","children","_messageArea$firstEle","firstElementChild","removeChild","messageText","systemPrompt","messagesToSend","currentTurnContent","msg","parts","contextId","saveConversationToStorage","aiMessageId","iE","showTypingIndicator","AbortController","_x","_x2","_x3","_x4","_x5","_callChatAPI","callChatAPI","chunk","reasoningChunk","hideTypingIndicator","finalElement","_finalElement$querySe","finalContent","lastAiMsg","pop","shift","_callee","messages","callback","url","headers","requestBodyPayload","effectiveModelName","_abortController","response","_errorData$error","errorData","errorDetail","errorMessage","reader","decoder","buffer","fullResponseContent","fullReasoningContent","_yield$reader$read","endOfLineIndex","line","dataString","data","chunkContent","currentReasoningChunk","_data","responseContent","reasoningData","_finalElement$querySe2","partialContent","_t2","_context","contents","stream","param","fetch","method","signal","ok","json","statusText","status","getReader","TextDecoder","read","decode","indexOf","startsWith","cancel","candidates","choices","delta","reasoning_content","warn","promptFeedback","blockReason","blockReasonMessage","aborted","_fetchModels","_callee2","modelsUrl","fetchHeaders","_errorData$error2","modelIds","preferredModel","_t3","_context2","catch","_model$supportedGener","supportedGenerationMethods","sort","localeCompare","find","coercionType","CoercionType","Table","Text","getSelectedDataAsync","asyncResult","AsyncResultStatus","Failed","textResult","Succeeded","processSelectedContent","isTable","formattedContent","rows","headerLine","separatorLine","rowLines","row","currentInput","setSelectedDataAsync","abort","aC","_document$getElementB","_document$getElementB2","iL","uAB","uAT","aAB","aAT","createUserListItem","s","iB","aB","aT","li","dataset","username","isBot","av","nS","sI","setProperty","cursor","fS","handleClickOutsideEmojiPicker","removeEventListener","ev","nH","max","min","it","idx","_apiConfig$customBody","rm","splice","removeCustomBodyParam","currentTarget","index","k","confirm","URL"],"sourceRoot":""}